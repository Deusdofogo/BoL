PVzpBdHRhY2sodGFyZ2V0KQoJc2VsZi5MYXN0QXR0YWNrID0gc2VsZjpHZXRUaW1lKCkgKyBzZWxmOkxhdGVuY3koKQoJbXlIZXJvOkF0dGFjayh0YXJnZXQpCmVuZAoKZnVuY3Rpb24gU09XOldpbmRVcFRpbWUoZXhhY3QpCglyZXR1cm4gKDEgLyAobXlIZXJvLmF0dGFja1NwZWVkICogc2VsZi5CYXNlV2luZHVwVGltZSkpICsgKGV4YWN0IGFuZCAwIG9yIEdldFNhdmUoIlNPVyIpLkV4dHJhV2luZFVwVGltZSAvIDEwMDApCmVuZAoKZnVuY3Rpb24gU09XOkFuaW1hdGlvblRpbWUoKQoJcmV0dXJuICgxIC8gKG15SGVyby5hdHRhY2tTcGVlZCAqIHNlbGYuQmFzZUFuaW1hdGlvblRpbWUpKQplbmQKCmZ1bmN0aW9uIFNPVzpMYXRlbmN5KCkKCXJldHVybiBHZXRMYXRlbmN5KCkgLyAyMDAwCmVuZAoKZnVuY3Rpb24gU09XOkNhbkF0dGFjaygpCglpZiBzZWxmLkxhc3RBdHRhY2sgPD0gc2VsZjpHZXRUaW1lKCkgdGhlbgoJCXJldHVybiAoc2VsZjpHZXRUaW1lKCkgKyBzZWxmOkxhdGVuY3koKSAgPiBzZWxmLkxhc3RBdHRhY2sgKyBzZWxmOkFuaW1hdGlvblRpbWUoKSkKCWVuZAoJcmV0dXJuIGZhbHNlCmVuZAoKZnVuY3Rpb24gU09XOkNhbk1vdmUoKQoJaWYgc2VsZi5MYXN0QXR0YWNrIDw9IHNlbGY6R2V0VGltZSgpIHRoZW4KCQlyZXR1cm4gKChzZWxmOkdldFRpbWUoKSArIHNlbGY6TGF0ZW5jeSgpID4gc2VsZi5MYXN0QXR0YWNrICsgc2VsZjpXaW5kVXBUaW1lKCkpIG9yIHNlbGYuUGFydGljbGVDcmVhdGVkKSBhbmQgbm90IF9HLmV2YWRlCgllbmQ