XOlZhbGlkU3R1ZmYoKQoJbG9jYWwgcmVzdWx0ID0gc2VsZjpHZXRUYXJnZXQoKQoKCWlmIHJlc3VsdCB0aGVuIAoJCXJldHVybiByZXN1bHQKCWVuZAoKCWZvciBpLCBtaW5pb24gaW4gaXBhaXJzKHNlbGYuRW5lbXlNaW5pb25zLm9iamVjdHMpIGRvCgkJbG9jYWwgdGltZSA9IHNlbGY6QW5pbWF0aW9uVGltZSgpICsgR2V0RGlzdGFuY2UobWluaW9uLnZpc2lvblBvcywgbXlIZXJvLnZpc2lvblBvcykgLyBzZWxmLlByb2plY3RpbGVTcGVlZCAtIDAuMDcKCQlsb2NhbCBwZGFtYWdlMiA9IG1pbmlvbi5oZWFsdGggLSBzZWxmLlZQOkdldFByZWRpY3RlZEhlYWx0aChtaW5pb24sIHRpbWUsIEdldFNhdmUoIlNPVyIpLkZhcm1EZWxheSAvIDEwMDApCgkJbG9jYWwgcGRhbWFnZSA9IHNlbGYuVlA6R2V0UHJlZGljdGVkSGVhbHRoMihtaW5pb24sIHRpbWUgKiAyKQoJCWlmIHNlbGY6VmFsaWRUYXJnZXQobWluaW9uKSBhbmQgKChwZGFtYWdlKSA+IDIqc2VsZi5WUDpDYWxjRGFtYWdlT2ZBdHRhY2sobXlIZXJvLCBtaW5pb24sIHtuYW1lID0gIkJhc2ljIn0sIDApICsgc2VsZjpCb251c0RhbWFnZShtaW5pb24pIG9yIHBkYW1hZ2UyID09IDApIHRoZW4KCQkJcmV0dXJuIG1pbmlvbgoJCWVuZAoJZW5kCgoJZm9yIGksIG1pbmlvbiBpbiBpcGFpcnMoc2VsZi5KdW5nbGVNaW5pb25zLm9iamVjdHMpIGRvCgkJaWYgc2VsZjpWYWxpZFRhcmdldChtaW5pb24pIHRoZW4KCQkJcmV0dXJuIG1pbmlvbgoJCWVuZAoJZW5kCgoJZm9yIGksIG1pbmlvbiBpbiBpcGFpcnM